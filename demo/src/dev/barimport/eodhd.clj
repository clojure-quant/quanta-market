(ns dev.barimport.eodhd
  (:require
   [tick.core :as t]
   [ta.import.provider.eodhd.ds :refer [create-import-eodhd]]
   [ta.import.provider.eodhd.raw :as raw]
   [ta.db.bars.protocol :as b]
   [dev.env :refer [secrets]]))

(:eodhd secrets)

;; RAW

(def d (raw/get-bars (:eodhd secrets)
                     "MCD.US" "2024-01-01" "2024-03-15"))

d
(->> (raw/get-bars (:eodhd secrets)
                   "MCD.US" "2020-01-01" "2024-03-15")
     raw/warning)
;; => "Data is limited by one year as you have free subscription"

;; DS

(def eodhd (create-import-eodhd (:eodhd secrets)))

(b/get-bars eodhd
            {:asset "RPM.AU"
             :calendar [:us :d]}
            {:start (t/zoned-date-time "2024-01-01T00:00:00Z")
             :end (t/zoned-date-time "2024-03-20T00:00:00Z")})
;; => _unnamed [56 7]:
;;    
;;    |                :date | :open | :high |  :low | :close | :adjusted_close | :volume |
;;    |----------------------|------:|------:|------:|-------:|----------------:|--------:|
;;    | 2024-01-02T00:00:00Z | 0.087 | 0.097 | 0.087 |  0.096 |           0.096 |  135383 |
;;    | 2024-01-03T00:00:00Z | 0.092 | 0.095 | 0.090 |  0.095 |           0.095 |  169381 |
;;    | 2024-01-04T00:00:00Z | 0.090 | 0.090 | 0.089 |  0.089 |           0.089 |   88120 |
;;    | 2024-01-05T00:00:00Z | 0.089 | 0.089 | 0.089 |  0.089 |           0.089 |       0 |
;;    | 2024-01-08T00:00:00Z | 0.090 | 0.090 | 0.090 |  0.090 |           0.090 |   25000 |
;;    | 2024-01-09T00:00:00Z | 0.090 | 0.090 | 0.090 |  0.090 |           0.090 |   71562 |
;;    | 2024-01-10T00:00:00Z | 0.090 | 0.090 | 0.090 |  0.090 |           0.090 |  135000 |
;;    | 2024-01-11T00:00:00Z | 0.090 | 0.090 | 0.090 |  0.090 |           0.090 |       0 |
;;    | 2024-01-12T00:00:00Z | 0.090 | 0.090 | 0.090 |  0.090 |           0.090 |       0 |
;;    | 2024-01-15T00:00:00Z | 0.088 | 0.091 | 0.088 |  0.091 |           0.091 |   62023 |
;;    |                  ... |   ... |   ... |   ... |    ... |             ... |     ... |
;;    | 2024-03-06T00:00:00Z | 0.088 | 0.088 | 0.087 |  0.087 |           0.087 |   10023 |
;;    | 2024-03-07T00:00:00Z | 0.087 | 0.087 | 0.084 |  0.084 |           0.084 |  186854 |
;;    | 2024-03-08T00:00:00Z | 0.087 | 0.087 | 0.084 |  0.086 |           0.086 |   18100 |
;;    | 2024-03-11T00:00:00Z | 0.087 | 0.087 | 0.087 |  0.087 |           0.087 |   11111 |
;;    | 2024-03-12T00:00:00Z | 0.087 | 0.088 | 0.086 |  0.086 |           0.086 |   69083 |
;;    | 2024-03-13T00:00:00Z | 0.087 | 0.087 | 0.086 |  0.086 |           0.086 |   69879 |
;;    | 2024-03-14T00:00:00Z | 0.086 | 0.086 | 0.084 |  0.084 |           0.084 |  118998 |
;;    | 2024-03-15T00:00:00Z | 0.084 | 0.084 | 0.083 |  0.083 |           0.083 |   70977 |
;;    | 2024-03-18T00:00:00Z | 0.084 | 0.084 | 0.083 |  0.083 |           0.083 |   22961 |
;;    | 2024-03-19T00:00:00Z | 0.083 | 0.083 | 0.083 |  0.083 |           0.083 |   71606 |
;;    | 2024-03-20T00:00:00Z | 0.082 | 0.082 | 0.082 |  0.082 |           0.082 |   50000 |
